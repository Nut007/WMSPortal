!function () { function t(t) { for (var n, e, i = t.css("color"), t = t[0], r = !1; t && !e && !r;) { try { n = $(t).css("background-color") } catch (s) { n = "transparent" } "transparent" !== n && "rgba(0, 0, 0, 0)" !== n && (e = n), r = t.body, t = t.parentNode } var o, t = /rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/, r = /#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/; n = void 0, (n = i.match(t)) ? o = { r: parseInt(n[1], 10), g: parseInt(n[2], 10), b: parseInt(n[3], 10) } : (n = i.match(r)) && (o = { r: parseInt(n[1], 16), g: parseInt(n[2], 16), b: parseInt(n[3], 16) }); var a; return e ? (n = void 0, (n = e.match(t)) ? a = { r: parseInt(n[1], 10), g: parseInt(n[2], 10), b: parseInt(n[3], 10) } : (n = e.match(r)) && (a = { r: parseInt(n[1], 16), g: parseInt(n[2], 16), b: parseInt(n[3], 16) })) : a = o && 127 < Math.max.apply(null, [o.r, o.g, o.b]) ? { r: 0, g: 0, b: 0 } : { r: 255, g: 255, b: 255 }, n = function (t) { return "rgb(" + [t.r, t.g, t.b].join(", ") + ")" }, o && a ? (t = Math.max.apply(null, [o.r, o.g, o.b]), o = Math.max.apply(null, [a.r, a.g, a.b]), o = Math.round(o + -.75 * (o - t)), o = { r: o, g: o, b: o }) : o ? (o = Math.max.apply(null, [o.r, o.g, o.b]), t = 1, o > 127 && (t = -1), o = Math.round(o + 96 * t), o = { r: o, g: o, b: o }) : o = { r: 191, g: 191, b: 191 }, { color: i, "background-color": a ? n(a) : e, "decor-color": n(o) } } function n(t, n) { this.x = t, this.y = n, this.reverse = function () { return new this.constructor(-1 * this.x, -1 * this.y) }, this._length = null, this.getLength = function () { return this._length || (this._length = Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2))), this._length }; var e = function (t) { return Math.round(t / Math.abs(t)) }; this.resizeTo = function (t) { if (0 === this.x && 0 === this.y) this._length = 0; else if (0 === this.x) this._length = t, this.y = t * e(this.y); else if (0 === this.y) this._length = t, this.x = t * e(this.x); else { var n = Math.abs(this.y / this.x), i = Math.sqrt(Math.pow(t, 2) / (1 + Math.pow(n, 2))), n = n * i; this._length = t, this.x = i * e(this.x), this.y = n * e(this.y) } return this }, this.angleTo = function (t) { var n = this.getLength() * t.getLength(); return 0 === n ? 0 : Math.acos(Math.min(Math.max((this.x * t.x + this.y * t.y) / n, -1), 1)) / Math.PI } } function e(t, e) { this.x = t, this.y = e, this.getVectorToCoordinates = function (t, e) { return new n(t - this.x, e - this.y) }, this.getVectorFromCoordinates = function (t, n) { return this.getVectorToCoordinates(t, n).reverse() }, this.getVectorToPoint = function (t) { return new n(t.x - this.x, t.y - this.y) }, this.getVectorFromPoint = function (t) { return this.getVectorToPoint(t).reverse() } } function i(t, n, e, i, r) { if (this.data = t, this.context = n, t.length) for (var s, o, a = t.length, h = 0; a > h; h++) { s = t[h], o = s.x.length, e.call(n, s); for (var u = 1; o > u; u++) i.call(n, s, u); r.call(n, s) } this.changed = function () { }, this.startStrokeFn = e, this.addToStrokeFn = i, this.endStrokeFn = r, this.inStroke = !1, this._stroke = this._lastPoint = null, this.startStroke = function (t) { if (t && "number" == typeof t.x && "number" == typeof t.y) { this._stroke = { x: [t.x], y: [t.y] }, this.data.push(this._stroke), this._lastPoint = t, this.inStroke = !0; var n = this._stroke, e = this.startStrokeFn, i = this.context; return setTimeout(function () { e.call(i, n) }, 3), t } return null }, this.addToStroke = function (t) { if (this.inStroke && "number" == typeof t.x && "number" == typeof t.y && 4 < Math.abs(t.x - this._lastPoint.x) + Math.abs(t.y - this._lastPoint.y)) { var n = this._stroke.x.length; this._stroke.x.push(t.x), this._stroke.y.push(t.y), this._lastPoint = t; var e = this._stroke, i = this.addToStrokeFn, r = this.context; return setTimeout(function () { i.call(r, e, n) }, 3), t } return null }, this.endStroke = function () { var t = this.inStroke; if (this.inStroke = !1, this._lastPoint = null, t) { var n = this._stroke, e = this.endStrokeFn, i = this.context, r = this.changed; return setTimeout(function () { e.call(i, n), r.call(i) }, 3), !0 } return null } } function r(n, i, r) { var h = this.$parent = $(n), n = this.eventTokens = {}; this.events = new a(this); var u = $.fn[s]("globalEvents"), l = { width: "ratio", height: "ratio", sizeRatio: 4, color: "#000", "background-color": "#fff", "decor-color": "#eee", lineWidth: 0, minFatFingerCompensation: -10, showUndoButton: !1, data: [] }; $.extend(l, t(h)), i && $.extend(l, i), this.settings = l; for (var c in r) r.hasOwnProperty(c) && r[c].call(this, c); this.events.publish(s + ".initializing"), this.$controlbarUpper = $('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(h), this.isCanvasEmulator = !1, r = this.canvas = this.initializeCanvas(l), i = $(r), this.$controlbarLower = $('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(h), this.canvasContext = r.getContext("2d"), i.data(s + ".this", this), h = (h = l.lineWidth) ? h : Math.max(Math.round(r.width / 400), 2), l.lineWidth = h, this.lineCurveThreshold = 3 * l.lineWidth, l.cssclass && "" != $.trim(l.cssclass) && i.addClass(l.cssclass), this.fatFingerCompensation = 0; var h = function (t) { var n, i, r = function (r) { return r = r.changedTouches && 0 < r.changedTouches.length ? r.changedTouches[0] : r, new e(Math.round(r.pageX + n), Math.round(r.pageY + i) + t.fatFingerCompensation) }, s = new o(750, function () { t.dataEngine.endStroke() }); return this.drawEndHandler = function (n) { try { null != n && n.preventDefault() } catch (e) { } s.clear(), t.dataEngine.endStroke() }, this.drawStartHandler = function (e) { e.preventDefault(); var o = $(t.canvas).offset(); n = -1 * o.left, i = -1 * o.top, t.dataEngine.startStroke(r(e)), s.kick() }, this.drawMoveHandler = function (n) { null != n && (n.preventDefault(), t.dataEngine.inStroke && (t.dataEngine.addToStroke(r(n)), s.kick())) }, this }.call({}, this), d = h.drawEndHandler, g = h.drawStartHandler, p = h.drawMoveHandler, f = this.canvas, i = $(f); this.isCanvasEmulator ? (i.bind("mousemove." + s, p), i.bind("mouseup." + s, d), i.bind("mousedown." + s, g)) : (f.ontouchstart = function (t) { f.onmousedown = void 0, f.onmouseup = void 0, f.onmousemove = void 0, this.fatFingerCompensation = l.minFatFingerCompensation && -3 * l.lineWidth > l.minFatFingerCompensation ? -3 * l.lineWidth : l.minFatFingerCompensation, g(t), f.ontouchend = d, f.ontouchstart = g, f.ontouchmove = p }, f.onmousedown = function (t) { f.ontouchstart = void 0, f.ontouchend = void 0, f.ontouchmove = void 0, g(t), f.onmousedown = g, f.onmouseup = d, f.onmousemove = p }), n[s + ".windowmouseup"] = u.subscribe(s + ".windowmouseup", h.drawEndHandler), this.events.publish(s + ".attachingEventHandlers"); var v = this, n = l.width.toString(10), y = s; return ("ratio" === n || "%" === n.split("")[n.length - 1]) && (this.eventTokens[y + ".parentresized"] = u.subscribe(y + ".parentresized", function (t, n, e) { return function () { var i = n.width(); if (i !== e) { for (var r in t) t.hasOwnProperty(r) && (u.unsubscribe(t[r]), delete t[r]); var s = v.settings; v.$parent.children().remove(); for (r in v) v.hasOwnProperty(r) && delete v[r]; r = s.data; var o, a, h, l, c, d, i = 1 * i / e, g = []; for (a = 0, h = r.length; h > a; a++) { for (d = r[a], o = { x: [], y: [] }, l = 0, c = d.x.length; c > l; l++) o.x.push(d.x[l] * i), o.y.push(d.y[l] * i); g.push(o) } s.data = g, n[y](s) } } }(this.eventTokens, this.$parent, this.$parent.width(), 1 * this.canvas.width / this.canvas.height))), this.resetCanvas(l.data), this.events.publish(s + ".initialized"), this } var s = "jSignature", o = function (t, n) { var e; return this.kick = function () { clearTimeout(e), e = setTimeout(n, t) }, this.clear = function () { clearTimeout(e) }, this }, a = function (t) { this.topics = {}, this.context = t ? t : this, this.publish = function (t, n, e, i) { if (this.topics[t]) { var r, s, o, a, h = this.topics[t], u = Array.prototype.slice.call(arguments, 1), l = []; for (s = 0, o = h.length; o > s; s++) a = h[s], r = a[0], a[1] && (a[0] = function () { }, l.push(s)), r.apply(this.context, u); for (s = 0, o = l.length; o > s; s++) h.splice(l[s], 1) } }, this.subscribe = function (t, n, e) { return this.topics[t] ? this.topics[t].push([n, e]) : this.topics[t] = [[n, e]], { topic: t, callback: n } }, this.unsubscribe = function (t) { if (this.topics[t.topic]) for (var n = this.topics[t.topic], e = 0, i = n.length; i > e; e++) n[e][0] === t.callback && n.splice(e, 1) } }, h = function (t) { var n = this.canvasContext, e = t.x[0], t = t.y[0], i = this.settings.lineWidth, r = n.fillStyle; n.fillStyle = n.strokeStyle, n.fillRect(e + i / -2, t + i / -2, i, i), n.fillStyle = r }, u = function (t, i) { var r = new e(t.x[i - 1], t.y[i - 1]), s = new e(t.x[i], t.y[i]), o = r.getVectorToPoint(s); if (i > 1) { var a, h = new e(t.x[i - 2], t.y[i - 2]), u = h.getVectorToPoint(r); if (u.getLength() > this.lineCurveThreshold) { a = i > 2 ? new e(t.x[i - 3], t.y[i - 3]).getVectorToPoint(h) : new n(0, 0); var l = .35 * u.getLength(), c = u.angleTo(a.reverse()), d = o.angleTo(u.reverse()); a = new n(a.x + u.x, a.y + u.y).resizeTo(Math.max(.05, c) * l); var g = new n(u.x + o.x, u.y + o.y).reverse().resizeTo(Math.max(.05, d) * l), u = this.canvasContext, l = h.x, d = h.y, c = r.x, p = r.y, f = h.x + a.x, h = h.y + a.y; a = r.x + g.x, g = r.y + g.y, u.beginPath(), u.moveTo(l, d), u.bezierCurveTo(f, h, a, g, c, p), u.stroke() } } o.getLength() <= this.lineCurveThreshold && (o = this.canvasContext, h = r.x, r = r.y, a = s.x, s = s.y, o.beginPath(), o.moveTo(h, r), o.lineTo(a, s), o.stroke()) }, l = function (t) { var i = t.x.length - 1; if (i > 0) { var r = new e(t.x[i], t.y[i]), s = new e(t.x[i - 1], t.y[i - 1]), o = s.getVectorToPoint(r); if (o.getLength() > this.lineCurveThreshold) { if (i > 1) { var t = new e(t.x[i - 2], t.y[i - 2]).getVectorToPoint(s), a = new n(t.x + o.x, t.y + o.y).resizeTo(o.getLength() / 2), o = this.canvasContext, t = s.x, i = s.y, h = r.x, u = r.y, l = s.x + a.x, s = s.y + a.y, a = r.x, r = r.y; o.beginPath(), o.moveTo(t, i), o.bezierCurveTo(l, s, a, r, h, u) } else o = this.canvasContext, t = s.x, s = s.y, i = r.x, r = r.y, o.beginPath(), o.moveTo(t, s), o.lineTo(i, r); o.stroke() } } }; r.prototype.resetCanvas = function (t) { var n = this.canvas, e = this.settings, r = this.canvasContext, o = this.isCanvasEmulator, a = n.width, c = n.height; r.clearRect(0, 0, a + 30, c + 30), r.shadowColor = r.fillStyle = e["background-color"], o && r.fillRect(0, 0, a + 30, c + 30), r.lineWidth = Math.ceil(parseInt(e.lineWidth, 10)), r.lineCap = r.lineJoin = "round", r.strokeStyle = e["decor-color"], r.shadowOffsetX = 0, r.shadowOffsetY = 0; var d = Math.round(c / 5), g = 1.5 * d, p = c - d, a = a - 1.5 * d, c = c - d; r.beginPath(), r.moveTo(g, p), r.lineTo(a, c), r.stroke(), r.strokeStyle = e.color, o || (r.shadowColor = r.strokeStyle, r.shadowOffsetX = .5 * r.lineWidth, r.shadowOffsetY = -.6 * r.lineWidth, r.shadowBlur = 0), t || (t = []), r = this.dataEngine = new i(t, this, h, u, l), e.data = t, $(n).data(s + ".data", t).data(s + ".settings", e); var f = this.$parent, v = this.events, y = s; return r.changed = function () { v.publish(y + ".change"), f.trigger("change") }, r.changed(), !0 }, r.prototype.initializeCanvas = function (t) { var n = document.createElement("canvas"), e = $(n); if (t.width === t.height && "ratio" === t.height && (t.width = "100%"), e.css("margin", 0).css("padding", 0).css("border", "none").css("height", "ratio" !== t.height && t.height ? t.height.toString(10) : 1).css("width", "ratio" !== t.width && t.width ? t.width.toString(10) : 1), e.appendTo(this.$parent), "ratio" === t.height ? e.css("height", Math.round(e.width() / t.sizeRatio)) : "ratio" === t.width && e.css("width", Math.round(e.height() * t.sizeRatio)), e.addClass(s), n.width = e.width(), n.height = e.height(), t = n, t.getContext) t = !1; else { var e = t.ownerDocument.parentWindow, i = e.FlashCanvas ? t.ownerDocument.parentWindow.FlashCanvas : "undefined" == typeof FlashCanvas ? void 0 : FlashCanvas; if (!i) throw Error("Canvas element does not support 2d context. jSignature cannot proceed."); if (t = i.initElement(t), i = 1, e && e.screen && e.screen.deviceXDPI && e.screen.logicalXDPI && (i = 1 * e.screen.deviceXDPI / e.screen.logicalXDPI), 1 !== i) try { $(t).children("object").get(0).resize(Math.ceil(t.width * i), Math.ceil(t.height * i)), t.getContext("2d").scale(i, i) } catch (r) { } t = !0 } return this.isCanvasEmulator = t, n.onselectstart = function (t) { return t && t.preventDefault && t.preventDefault(), t && t.stopPropagation && t.stopPropagation(), !1 }, n }; var c, d = window, g = function (t, n) { var e = new Image, i = this; e.onload = function () { i.getContext("2d").drawImage(e, 0, 0, e.width < i.width ? e.width : i.width, e.height < i.height ? e.height : i.height) }, e.src = "data:" + n + "," + t }, p = function (t) { return this.find("canvas." + s).add(this.filter("canvas." + s)).data(s + ".this").resetCanvas(t), this }, f = function (t, n) { if (void 0 !== n || "string" != typeof t || "data:" !== t.substr(0, 5) || (n = t.slice(5).split(",")[0], t = t.slice(6 + n.length), n !== t)) { var e = this.find("canvas." + s).add(this.filter("canvas." + s)); if (!b.hasOwnProperty(n)) throw Error(s + " is unable to find import plugin with for format '" + String(n) + "'"); return 0 !== e.length && b[n].call(e[0], t, n, function (t) { return function () { return t.resetCanvas.apply(t, arguments) } }(e.data(s + ".this"))), this } }, v = new a, y = s, x = function () { v.publish(y + ".parentresized") }; $(d).bind("resize." + y, function () { c && clearTimeout(c), c = setTimeout(x, 500) }).bind("mouseup." + y, function () { v.publish(y + ".windowmouseup") }); var m = {}, w = { "default": function () { return this.toDataURL() }, "native": function (t) { return t }, image: function () { var t = this.toDataURL(); if ("string" == typeof t && 4 < t.length && "data:" === t.slice(0, 5) && -1 !== t.indexOf(",")) { var n = t.indexOf(","); return [t.slice(5, n), t.substr(n + 1)] } return [] } }, b = { "native": function (t, n, e) { e(t) }, image: g, "image/png;base64": g, "image/jpeg;base64": g, "image/jpg;base64": g }, T = { "export": w, "import": b, instance: m }, C = { init: function (t) { return this.each(function () { var n, e = !1; for (n = this.parentNode; n && !e;) e = n.body, n = n.parentNode; !e || new r(this, t, m) }) }, getSettings: function () { return this.find("canvas." + s).add(this.filter("canvas." + s)).data(s + ".this").settings }, clear: p, reset: p, addPlugin: function (t, n, e) { return T.hasOwnProperty(t) && (T[t][n] = e), this }, listPlugins: function (t) { var n = []; if (T.hasOwnProperty(t)) { var e, t = T[t]; for (e in t) t.hasOwnProperty(e) && n.push(e) } return n }, getData: function (t) { var n = this.find("canvas." + s).add(this.filter("canvas." + s)); return void 0 === t && (t = "default"), 0 !== n.length && w.hasOwnProperty(t) ? w[t].call(n.get(0), n.data(s + ".data")) : void 0 }, importData: f, setData: f, globalEvents: function () { return v }, events: function () { return this.find("canvas." + s).add(this.filter("canvas." + s)).data(s + ".this").events } }; $.fn[s] = function (t) { return t && "object" != typeof t ? "string" == typeof t && C[t] ? C[t].apply(this, Array.prototype.slice.call(arguments, 1)) : void $.error("Method " + String(t) + " does not exist on jQuery." + s) : C.init.apply(this, arguments) } }(), function () { $.fn.jSignature("addPlugin", "instance", "UndoButton", function (t) { this.events.subscribe("jSignature.attachingEventHandlers", function () { if (this.settings[t]) { var n = this.settings[t]; "function" != typeof n && (n = function () { var t = $('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower), n = t.width(); return t.css("left", Math.round((this.canvas.width - n) / 2)), n !== t.width() && t.width(n), t }); var e = n.call(this), i = this; i.events.subscribe("jSignature.change", function () { i.dataEngine.data.length ? e.show() : e.hide() }); var r = this, s = (this.events.topics.hasOwnProperty("jSignature.undo") ? t : "jSignature") + ".undo"; e.bind("click", function () { r.events.publish(s) }), r.events.subscribe(s, function () { var t = r.dataEngine.data; t.length && (t.pop(), r.resetCanvas(t)) }) } }) }) }(), function () { for (var t = {}, n = {}, e = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""), i = e.length / 2, r = i - 1; r > -1; r--) t[e[r]] = e[r + i], n[e[r + i]] = e[r]; var s = function (n) { for (var n = n.split(""), e = n.length, i = 1; e > i; i++) n[i] = t[n[i]]; return n.join("") }, o = function (t) { for (var n, e, r = [], o = 0, a = 1, h = t.length, u = 0; h > u; u++) n = Math.round(t[u]), e = n - o, o = n, 0 > e && a > 0 ? (a = -1, r.push("Z")) : e > 0 && 0 > a && (a = 1, r.push("Y")), n = Math.abs(e), n >= i ? r.push(s(n.toString(i))) : r.push(n.toString(i)); return r.join("") }, a = function (e) { for (var r, s = [], e = e.split(""), o = e.length, a = 1, h = [], u = 0, l = 0; o > l; l++) r = e[l], r in t || "Z" === r || "Y" === r ? (0 !== h.length && (h = parseInt(h.join(""), i) * a + u, s.push(h), u = h), "Z" === r ? (a = -1, h = []) : "Y" === r ? (a = 1, h = []) : h = [r]) : h.push(n[r]); return s.push(parseInt(h.join(""), i) * a + u), s }, h = function (t) { for (var n, e = [], i = t.length, r = 0; i > r; r++) n = t[r], e.push(o(n.x)), e.push(o(n.y)); return e.join("_") }, u = function (t) { for (var n = [], t = t.split("_"), e = t.length / 2, i = 0; e > i; i++) n.push({ x: a(t[2 * i]), y: a(t[2 * i + 1]) }); return n }, e = function (t) { return ["image/jsignature;base30", h(t)] }, r = function (t, n, e) { "string" == typeof t && ("image/jsignature;base30" === t.substring(0, 23).toLowerCase() && (t = t.substring(24)), e(u(t))) }; if (null == this.jQuery) throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize..."); var l = this.jQuery.fn.jSignature; l("addPlugin", "export", "base30", e), l("addPlugin", "export", "image/jsignature;base30", e), l("addPlugin", "import", "base30", r), l("addPlugin", "import", "image/jsignature;base30", r), this.jSignatureDebug && (this.jSignatureDebug.base30 = { remapTailChars: s, compressstrokeleg: o, uncompressstrokeleg: a, compressstrokes: h, uncompressstrokes: u, charmap: t }) }.call("undefined" != typeof window ? window : this), function () { function t(t, n) { this.x = t, this.y = n, this.reverse = function () { return new this.constructor(-1 * this.x, -1 * this.y) }, this._length = null, this.getLength = function () { return this._length || (this._length = Math.sqrt(Math.pow(this.x, 2) + Math.pow(this.y, 2))), this._length }; var e = function (t) { return Math.round(t / Math.abs(t)) }; this.resizeTo = function (t) { if (0 === this.x && 0 === this.y) this._length = 0; else if (0 === this.x) this._length = t, this.y = t * e(this.y); else if (0 === this.y) this._length = t, this.x = t * e(this.x); else { var n = Math.abs(this.y / this.x), i = Math.sqrt(Math.pow(t, 2) / (1 + Math.pow(n, 2))), n = n * i; this._length = t, this.x = i * e(this.x), this.y = n * e(this.y) } return this }, this.angleTo = function (t) { var n = this.getLength() * t.getLength(); return 0 === n ? 0 : Math.acos(Math.min(Math.max((this.x * t.x + this.y * t.y) / n, -1), 1)) / Math.PI } } function n(n, e) { this.x = n, this.y = e, this.getVectorToCoordinates = function (n, e) { return new t(n - this.x, e - this.y) }, this.getVectorFromCoordinates = function (t, n) { return this.getVectorToCoordinates(t, n).reverse() }, this.getVectorToPoint = function (n) { return new t(n.x - this.x, n.y - this.y) }, this.getVectorFromPoint = function (t) { return this.getVectorToPoint(t).reverse() } } function e(t, n) { var e = Math.pow(10, n); return Math.round(t * e) / e } function i(i, r, s) { var r = r + 1, o = new n(i.x[r - 1], i.y[r - 1]), a = new n(i.x[r], i.y[r]), a = o.getVectorToPoint(a), h = new n(i.x[r - 2], i.y[r - 2]), o = h.getVectorToPoint(o); return o.getLength() > s ? (s = r > 2 ? new n(i.x[r - 3], i.y[r - 3]).getVectorToPoint(h) : new t(0, 0), i = .35 * o.getLength(), h = o.angleTo(s.reverse()), r = a.angleTo(o.reverse()), s = new t(s.x + o.x, s.y + o.y).resizeTo(Math.max(.05, h) * i), a = new t(o.x + a.x, o.y + a.y).reverse().resizeTo(Math.max(.05, r) * i), a = new t(o.x + a.x, o.y + a.y), ["c", e(s.x, 2), e(s.y, 2), e(a.x, 2), e(a.y, 2), e(o.x, 2), e(o.y, 2)]) : ["l", e(o.x, 2), e(o.y, 2)] } function r(i, r) { var s = i.x.length - 1, o = new n(i.x[s], i.y[s]), a = new n(i.x[s - 1], i.y[s - 1]), o = a.getVectorToPoint(o); if (s > 1 && o.getLength() > r) { var s = new n(i.x[s - 2], i.y[s - 2]).getVectorToPoint(a), a = o.angleTo(s.reverse()), h = .35 * o.getLength(), s = new t(s.x + o.x, s.y + o.y).resizeTo(Math.max(.05, a) * h); return ["c", e(s.x, 2), e(s.y, 2), e(o.x, 2), e(o.y, 2), e(o.x, 2), e(o.y, 2)] } return ["l", e(o.x, 2), e(o.y, 2)] } function s(t, n, s) { for (var n = ["M", e(t.x[0] - n, 2), e(t.y[0] - s, 2)], s = 1, o = t.x.length - 1; o > s; s++) n.push.apply(n, i(t, s, 1)); return o > 0 ? n.push.apply(n, r(t, s, 1)) : 0 === o && n.push.apply(n, ["l", 1, 1]), n.join(" ") } function o(t) { var n, e, i = ['<?xml version="1.0" encoding="UTF-8" standalone="no"?>', '<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'], r = t.length, o = [], a = [], h = e = n = 0, u = 0, l = []; if (0 !== r) { for (n = 0; r > n; n++) { h = t[n], u = [], e = { x: [], y: [] }; for (var c = void 0, d = void 0, c = 0, d = h.x.length; d > c; c++) u.push({ x: h.x[c], y: h.y[c] }); for (u = simplify(u, .7, !0), c = 0, d = u.length; d > c; c++) e.x.push(u[c].x), e.y.push(u[c].y); l.push(e), o = o.concat(e.x), a = a.concat(e.y) } t = Math.min.apply(null, o) - 1, r = Math.max.apply(null, o) + 1, o = Math.min.apply(null, a) - 1, a = Math.max.apply(null, a) + 1, h = 0 > t ? 0 : t, u = 0 > o ? 0 : o, n = r - t, e = a - o } for (i.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="' + n.toString() + '" height="' + e.toString() + '">'), n = 0, r = l.length; r > n; n++) e = l[n], i.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="' + s(e, h, u) + '"/>'); return i.push("</svg>"), i.join("") } function a(t) { return [c, o(t)] } function h(t) { return [d, l(o(t))] } var u = window; if (("undefined" != typeof exports ? exports : u).simplify = function (t, n, e) { if (n = void 0 !== n ? n * n : 1, !e) { for (var i, r = t.length, s = t[0], o = [s], e = 1; r > e; e++) { i = t[e]; var a = i.x - s.x, h = i.y - s.y; a * a + h * h > n && (o.push(i), s = i) } s !== i && o.push(i), t = o } i = t; var u, l, e = i.length, r = new ("undefined" != typeof Uint8Array ? Uint8Array : Array)(e), s = 0, o = e - 1, c = [], d = [], g = []; for (r[s] = r[o] = 1; o;) { for (h = 0, a = s + 1; o > a; a++) { u = i[a]; var p = i[s], f = i[o], v = p.x, y = p.y, p = f.x - v, x = f.y - y, m = void 0; (0 !== p || 0 !== x) && (m = ((u.x - v) * p + (u.y - y) * x) / (p * p + x * x), m > 1 ? (v = f.x, y = f.y) : m > 0 && (v += p * m, y += x * m)), p = u.x - v, x = u.y - y, u = p * p + x * x, u > h && (l = a, h = u) } h > n && (r[l] = 1, c.push(s), d.push(l), c.push(l), d.push(o)), s = c.pop(), o = d.pop() } for (a = 0; e > a; a++) r[a] && g.push(i[a]); return t = g }, "function" != typeof l) var l = function (t) { var n, e, i, r, s = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""), o = 0, a = 0, h = "", h = []; do n = t.charCodeAt(o++), e = t.charCodeAt(o++), i = t.charCodeAt(o++), r = n << 16 | e << 8 | i, n = r >> 18 & 63, e = r >> 12 & 63, i = r >> 6 & 63, r &= 63, h[a++] = s[n] + s[e] + s[i] + s[r]; while (o < t.length); return h = h.join(""), t = t.length % 3, (t ? h.slice(0, t - 3) : h) + "===".slice(t || 3) }; var c = "image/svg+xml", d = "image/svg+xml;base64"; if ("undefined" == typeof $) throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize..."); u = $.fn.jSignature, u("addPlugin", "export", "svg", a), u("addPlugin", "export", c, a), u("addPlugin", "export", "svgbase64", h), u("addPlugin", "export", d, h) }();